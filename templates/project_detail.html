{% extends "base.html" %} {% block title %}Project: {{ project.title }}{%
endblock %} {% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">Project: {{ project.title }}</h2>
  <a href="{{ url_for('projects') }}" class="btn btn-secondary"
    >Back to All Projects</a
  >
</div>

<div class="card mb-4">
  <div class="card-header d-flex justify-content-between">
    <span>Description</span>
    <span class="text-muted">Client: {{ project.client.name }}</span>
  </div>
  <div class="card-body">
    <p class="card-text">
      {{ project.description or 'No description provided.' }}
    </p>
  </div>
</div>

<div class="card mb-4">
  <div class="card-header">Task Checklist</div>
  <div class="card-body">
    <form
      action="{{ url_for('add_task', project_id=project.id) }}"
      method="POST"
      class="d-flex gap-2 mb-4"
    >
      <input
        type="text"
        name="task_description"
        class="form-control"
        placeholder="Add a new task..."
        required
      />
      <button type="submit" class="btn btn-primary">Add Task</button>
    </form>

    <ul class="list-group">
      {% for task in project.tasks %}
      <li
        class="list-group-item d-flex justify-content-between align-items-center"
      >
        <div class="form-check">
          <input
            class="form-check-input"
            type="checkbox"
            value=""
            id="task-{{ task.id }}"
            {%
            if
            task.is_completed
            %}checked{%
            endif
            %}
            onchange="toggleTask({{ task.id }})"
          />
          <label
            class="form-check-label {% if task.is_completed %}text-muted text-decoration-line-through{% endif %}"
            for="task-{{ task.id }}"
          >
            {{ task.description }}
          </label>
        </div>
      </li>
      {% else %}
      <li class="list-group-item text-center fst-italic">No tasks yet.</li>
      {% endfor %}
    </ul>
  </div>
</div>

<div class="card mb-4">
  <div class="card-header">Project Notes</div>
  <div class="card-body">
    <form
      action="{{ url_for('save_notes', project_id=project.id) }}"
      method="POST"
    >
      <div class="mb-3">
        <textarea
          name="notes"
          class="form-control"
          rows="8"
          placeholder="Add any private notes, thoughts, or reminders here..."
        >
{{ project.notes or '' }}</textarea
        >
      </div>
      <button type="submit" class="btn btn-primary">Save Notes</button>
    </form>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  function toggleTask(taskId) {
    fetch(`/toggle_task/${taskId}`, {
      method: "POST",
    })
      .then((response) => response.json())
      .then((data) => {
        if (data.success) {
          // Find the label and toggle its style
          const label = document.querySelector(`label[for="task-${taskId}"]`);
          if (data.is_completed) {
            label.classList.add("text-muted", "text-decoration-line-through");
          } else {
            label.classList.remove(
              "text-muted",
              "text-decoration-line-through"
            );
          }
          // We can optionally update the main project progress bar here later
        }
      });
  }
</script>
{% endblock %}
